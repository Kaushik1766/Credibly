"use strict";(()=>{var e={};e.id=6179,e.ids=[6179],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51822:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{POST:()=>d});var i=r(73278),n=r(45002),o=r(54877),s=r(71309),p=r(53524);async function u(e,t,r,a){let i=e.snippet.title,n=e.snippet.description,o=e.snippet.channelTitle,s="youtube#playlist"==e.kind?"playlist":"video",u="playlist"==s?e.id:e.snippet.resourceId.videoId,d=e.snippet.thumbnails.high.url,l=e.snippet.title.replaceAll(/\s/g,"_");try{let e=new p.PrismaClient,c=await e.videos.findUnique({where:{url_creatorId:{url:l,creatorId:a.youtubeId}}});if(c)return c.creatorId.slice(1)+"/"+c.url;let y=await fetch("https://api.pinata.cloud/pinning/pinJSONToIPFS",{method:"POST",headers:{"Content-Type":"application/json",pinata_api_key:"73c879f180b698a69faa",pinata_secret_api_key:"0a8396a79ee46480d58adb68a8e6aa202fa8ed27e9795a9a5527e0e26d8b8ed0"},body:JSON.stringify({title:i,description:n,author:o,tags:t,thumbnail:d,validation:r,videoId:u,type:s})});if(!y.ok)throw Error("Failed to upload data to Pinata");let h=(await y.json()).IpfsHash;await e.creator.findUnique({where:{youtubeId:a.youtubeId}})||await e.creator.create({data:{name:a.name,youtubeId:a.youtubeId}});let g=await e.videos.create({data:{cid:h,url:l,creatorId:a.youtubeId}});return console.log(g),g.creatorId.slice(1)+"/"+g.url}catch(e){throw console.error(e),Error(e.message)}}async function d(e){try{let{data:t,tags:r,validation:a,channelDetails:i}=await e.json();if(!t||!a||!r||!Array.isArray(r))return s.NextResponse.json({error:"Invalid data or tags"},{status:400});let n=await u(t,r,a,i);return s.NextResponse.json({cuid:n},{status:201})}catch(e){if(e instanceof Error)return s.NextResponse.json({error:e.message},{status:500});return s.NextResponse.json({error:"An unknown error occurred"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/getLink/route",pathname:"/api/getLink",filename:"route",bundlePath:"app/api/getLink/route"},resolvedPagePath:"/Users/jayanthkoppala/Desktop/Developer/Credibly/app/api/getLink/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:y,serverHooks:h}=l,g="/api/getLink/route";function f(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9379,4833],()=>r(51822));module.exports=a})();